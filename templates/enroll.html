{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Enroll | Tech Matrix</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script>
    // Validation for new users
    function validateForm(event) {
      event.preventDefault(); // Prevent form submission for validation

      const name = document.forms["enrollForm"]["name"].value.trim();
      const status = document.forms["enrollForm"]["status"].value;
      const phone = document.forms["enrollForm"]["phone"].value.trim();
      const email = document.forms["enrollForm"]["email"].value.trim();
      const password = document.forms["enrollForm"]["password"].value;
      const confirmPassword = document.forms["enrollForm"]["confirm_password"].value;

      // Name validation
      if (name === "") {
        alert("Please enter your full name.");
        return false;
      }

      // Phone validation
      const phonePattern = /^[0-9]{10}$/;
      if (!phonePattern.test(phone)) {
        alert("Please enter a valid 10-digit phone number.");
        return false;
      }

      // Email validation
      const emailPattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;
      if (!emailPattern.test(email)) {
        alert("Please enter a valid email address.");
        return false;
      }

      // Password strength validation
      const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&_])[A-Za-z\d@$!%*?&_]{8,}$/;
      if (!passwordPattern.test(password)) {
        alert("Password must be at least 8 characters long, include uppercase, lowercase, number, and special character.");
        return false;
      }

      // Confirm password check
      if (password !== confirmPassword) {
        alert("Passwords do not match.");
        return false;
      }

      // Submit if all validations pass
      document.forms["enrollForm"].submit();
    }

    // Toggle password visibility
    function togglePassword(fieldId, eyeId) {
      const field = document.getElementById(fieldId);
      const eye = document.getElementById(eyeId);
      if (field.type === "password") {
        field.type = "text";
        eye.textContent = "üôà";
      } else {
        field.type = "password";
        eye.textContent = "üëÅÔ∏è";
      }
    }
  </script>
</head>
<body class="bg-blue-50 flex items-center justify-center min-h-screen px-4">

<div class="bg-white rounded-2xl shadow-lg max-w-5xl w-full flex md:flex-row flex-col overflow-hidden">

  <!-- Left Preview -->
  <div class="md:w-1/2 bg-blue-100 p-8 flex flex-col items-center justify-center">
    {% if course_name %}
      <h2 class="text-3xl font-bold text-indigo-700 mb-4">Enrolling in</h2>
      <h3 class="text-xl font-semibold text-gray-800 mb-4">{{ course_name }}</h3>
      <img src="{% static course_image %}" alt="{{ course_name }}" class="w-full max-w-xs mx-auto rounded-lg shadow-md">
    {% else %}
      <h2 class="text-3xl font-bold text-indigo-700">Tech Matrix</h2>
      <p class="text-gray-600 mt-2">Explore a world of learning</p>
    {% endif %}
  </div>

  <!-- Right Form / Message -->
  <div class="md:w-1/2 p-8">
    <h2 class="text-2xl font-bold text-center text-indigo-700 mb-2">Enrollment Form</h2>

    {% if error %}
      <p class="text-red-500 text-center mb-2">{{ error }}</p>
    {% endif %}

    {% if skip_password %}
      <p class="text-green-600 text-center text-lg mb-4">
        ‚úÖ You're logged in. No need to enter your details or password.
      </p>
    {% endif %}

    <form name="enrollForm" method="POST" class="space-y-4"
          {% if not skip_password %}onsubmit="validateForm(event)"{% endif %}>
      {% csrf_token %}

      {% if not skip_password %}
      <!-- Fields for new users -->
      <input type="text" name="name" placeholder="Full Name" required class="w-full p-2 border rounded">
      <select name="status" required class="w-full p-2 border rounded">
        <option value="">Select Status</option>
        <option value="Student">Student</option>
        <option value="Working">Working</option>
        <option value="Housewife">Housewife</option>
      </select>
      <input type="text" name="phone" placeholder="Phone" required class="w-full p-2 border rounded">
      <input type="email" name="email" placeholder="Email" required class="w-full p-2 border rounded">

      <div class="relative">
        <input type="password" id="password" name="password" placeholder="Password" required class="w-full p-2 border rounded">
        <span id="eyePassword" onclick="togglePassword('password','eyePassword')" 
              class="absolute right-3 top-2.5 cursor-pointer text-xl">üëÅÔ∏è</span>
      </div>

      <div class="relative">
        <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm Password" required class="w-full p-2 border rounded">
        <span id="eyeConfirm" onclick="togglePassword('confirm_password','eyeConfirm')" 
              class="absolute right-3 top-2.5 cursor-pointer text-xl">üëÅÔ∏è</span>
      </div>

      <p class="text-center text-yellow-800 font-medium mb-4">
        ‚ö†Ô∏è Already a user? <a href="{% url 'login' %}" class="underline font-semibold">Login</a> to purchase this course.
      </p>
      {% endif %}

      {% if not enrolled %}
        <button type="submit" class="w-full py-3 text-white font-semibold bg-indigo-600 rounded-lg hover:bg-indigo-700 transition">
          Proceed to Pay ‚Çπ{{ amount }}

        </button>
      {% else %}
        <p class="text-green-600 text-center mt-4">
          ‚úÖ You are already enrolled in this course. Payment not required.
        </p>
      {% endif %}
    </form>
  </div>

</div>

</body>
</html>
